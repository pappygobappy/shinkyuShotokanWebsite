{{ define "add_event_type_modal" }}
<dialog id="add_event_type_modal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg">Add Event Type</h3>
        <form id="add_event_type_form" hx-post="/admin/start_add_event" hx-push-url="false" hx-target=".content"
            hx-swap="outerHTML show:top" enctype="multipart/form-data">
            <select class="select select-bordered w-full max-w-xs" name="EventType" onchange="handleEventTypeChange(this)">
                <option disabled selected>Event Type</option>
                <option>Promotional</option>
                <option>Tournament</option>
                <option>Other</option>
            </select>
            {{ range .EventTypes }}
            <div id="{{ .Name }}_type_section" class="hidden">
                <label class="label">
                    <span class="text-base label-text">{{.Name}} Type</span>
                </label>
                {{ $type := .Name }}
                <div class="form-control">
                    {{ range .GetSubTypes }}
                    <label class="label cursor-pointer">
                        <span class="label-text">{{ .Name }}</span>
                        <input type="radio" name="SubType" value="{{ .Name }}" class="radio radio-primary" onchange="handleSubTypeChange(this, {{$type}})" />
                    </label>
                    {{ end }}
                </div>
            </div>
            {{ end }}
            <!-- <div id="promotional_type_section" class="hidden">
                <label class="label">
                    <span class="text-base label-text">Promotional Type</span>
                </label>
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Pre-Karate</span>
                        <input type="radio" name="PromotionalType" value="Pre-Karate" class="radio radio-primary" onchange="handlePromotionalTypeChange(this)" />
                    </label>
                    <label class="label cursor-pointer">
                        <span class="label-text">Youth & Adult</span>
                        <input type="radio" name="PromotionalType" value="Youth & Adult" class="radio radio-primary" onchange="handlePromotionalTypeChange(this)" />
                    </label>
                </div>
            </div>
            <div id="tournament_type_section" class="hidden">
                <label class="label">
                    <span class="text-base label-text">Tournament Type</span>
                </label>
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Youth</span>
                        <input type="radio" name="TournamentType" value="Youth" class="radio radio-primary" onchange="handleTournamentTypeChange(this)" />
                    </label>
                    <label class="label cursor-pointer">
                        <span class="label-text">Teen & Adult</span>
                        <input type="radio" name="TournamentType" value="Teen & Adult" class="radio radio-primary" onchange="handleTournamentTypeChange(this)" />
                    </label>
                    <label class="label cursor-pointer">
                        <span class="label-text">All Ages</span>
                        <input type="radio" name="TournamentType" value="All Ages" class="radio radio-primary" onchange="handleTournamentTypeChange(this)" />
                    </label>
                </div>
            </div> -->
            <label class="label">
                <span class="text-base label-text">Date</span>
            </label>
            <input type="date" placeholder="Event Date" class="w-full input input-bordered" name="Date" required />
            <label class="label">
                <span class="text-base label-text">Start Time</span>
            </label>
            <input type="time" placeholder="Start Time" class="w-full input input-bordered" name="StartTime" required />
            <label class="label">
                <span class="text-base label-text">End Time</span>
            </label>
            <input type="time" placeholder="End Time" class="w-full input input-bordered" name="EndTime" required />
            <label class="label">
                <span class="text-base label-text">Check-in Time</span>
            </label>
            <input type="time" placeholder="Check-in Time" class="w-full input input-bordered" name="CheckInTime" required />
            <div id="registration_close_section">
                <!-- This section will be dynamically updated based on event type -->
            </div>
            <label class="label">
                <span class="text-base label-text">Event Location</span>
            </label>
            <select class="select select-bordered w-full max-w-xs" name="Location">
                <option disabled selected>Event Location</option>
                {{ range .Locations }}
                <option>{{ .Name }}</option>
                {{ end }}
            </select>
        </form>
        <div class="modal-action">
            <form method="dialog">
                <!-- if there is a button in form, it will close the modal -->
                <button class="btn">Close</button>
            </form>
            <input type="Submit" form="add_event_type_form" class="btn btn-primary" />
        </div>
    </div>
</dialog>

<script>
    var eventTypes = {{.EventTypes}}
function handleEventTypeChange(select) {
    const promotionalSection = document.getElementById('Promotional_type_section');
    const tournamentSection = document.getElementById('Tournament_type_section');
    const registrationCloseSection = document.getElementById('registration_close_section');
    
    // Hide all sections initially
    promotionalSection.classList.add('hidden');
    tournamentSection.classList.add('hidden');
    registrationCloseSection.innerHTML = '';
    
    if (select.value === 'Promotional') {
        promotionalSection.classList.remove('hidden');
    } else if (select.value === 'Tournament') {
        tournamentSection.classList.remove('hidden');
        // Add tournament registration close fields
        registrationCloseSection.innerHTML = `
            <label class="label">
                <span class="text-base label-text">Online Registration Close Date</span>
            </label>
            <input type="date" placeholder="Registration Close Date" class="w-full input input-bordered" name="RegistrationCloseDate" />
            <label class="label">
                <span class="text-base label-text">Online Registration Close Time</span>
            </label>
            <input type="time" placeholder="Registration Close Time" class="w-full input input-bordered" name="RegistrationCloseTime" />
        `;
    }
}

function handleSubTypeChange(radio, subType) {
    const promotionalType = eventTypes.find(type => type.Name === subType);
    const selectedTemplate = promotionalType.Templates.find(template => 
        template.SubTypes.some(subType => subType.Name === radio.value)
    );
    console.log(promotionalType)
    console.log(selectedTemplate)
    const startTimeInput = document.querySelector('input[name="StartTime"]');
    const endTimeInput = document.querySelector('input[name="EndTime"]');
    const checkInTimeInput = document.querySelector('input[name="CheckInTime"]');
    const locationSelect = document.querySelector('select[name="Location"]');
    
    // Set the times from the template
    startTimeInput.value = selectedTemplate.StartTime;
    endTimeInput.value = selectedTemplate.EndTime;
    checkInTimeInput.value = selectedTemplate.CheckInTime;
    
    // Set location if specified in template
    if (selectedTemplate.Location) {
        Array.from(locationSelect.options).forEach(option => {
            if (option.value === selectedTemplate.Location) {
                locationSelect.value = option.value;
            }
        });
    }
}
</script>

{{ end }}
{{ define "edit_instructor" }}
<div class="content">
    {{ template "header" makeMap "Page" .Page "user" .user }}
    <div class="instructor mx-auto md:py-5 md:px-7 max-w-7xl bg-base-100 md:rounded-xl md:my-5">
        <div class="text-3xl border-b py-5 flex flex-row items-center">
            <h1>{{ if .Instructor.ID }}Edit{{ else }}Add{{ end }} Instructor</h1>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Form Column -->
                <div>
                    <form {{ if .Instructor.ID }}hx-put="/admin/instructors/{{ .Instructor.ID }}"{{ else }}hx-post="/admin/instructors"{{ end }} hx-target=".content" hx-push-url="true" hx-swap="outerHTML" enctype="multipart/form-data">
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text">Instructor Name</span>
                            </label>
                            <input type="text" placeholder="Instructor Name" class="input input-bordered w-full" 
                                   value="{{ .Instructor.Name }}" name="Name" id="name-input" oninput="updateInstructorPreview()" required />
                        </div>
                        
                        {{ if .Instructor.ID }}
                            <div class="form-control w-full mt-4">
                                <label class="label">
                                    <span class="label-text">Current Picture</span>
                                </label>
                                <div class="flex items-center gap-4">
                                    <img src="{{ .Instructor.PictureUrl }}" alt="Current instructor photo" class="w-20 h-20 object-cover rounded-lg" id="current-picture">
                                    <div class="text-sm text-gray-600">
                                        Current: {{ .Instructor.PictureUrl }}
                                    </div>
                                </div>
                            </div>
                        {{ end }}
                        
                        <div class="form-control w-full mt-4">
                            <label class="label">
                                <span class="label-text">Upload New Picture</span>
                            </label>
                            <input type="file" accept="image/*" class="file-input file-input-bordered file-input-warning w-full" 
                                   name="NewPicture" id="picture-upload" onchange="previewImage(this)" />
                            <div class="label">
                                <span class="label-text-alt">{{ if .Instructor.ID }}Leave empty to keep current picture{{ else }}Optional{{ end }}</span>
                            </div>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Picture Zoom: <span id="zoomValue">{{ if .Instructor.ZoomLevel }}{{ .Instructor.ZoomLevel }}%{{ else }}100%{{ end }}</span></span>
                            </label>
                            <input name="ZoomLevel" type="range" min="100" max="300" value="{{ if .Instructor.ZoomLevel }}{{ .Instructor.ZoomLevel }}{{ else }}100{{ end }}" class="range range-xs range-warning" oninput="updateZoomValue(this)"/>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Picture Offset X: <span id="offsetXValue">{{ if .Instructor.OffsetX }}{{ .Instructor.OffsetX }}{{ else }}0{{ end }}px</span></span>
                            </label>
                            <input name="OffsetX" type="range" min="-100" max="100" value="{{ if .Instructor.OffsetX }}{{ .Instructor.OffsetX }}{{ else }}0{{ end }}" class="range range-xs range-accent" oninput="updateOffsetXValue(this)"/>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Picture Offset Y: <span id="offsetYValue">{{ if .Instructor.OffsetY }}{{ .Instructor.OffsetY }}{{ else }}0{{ end }}px</span></span>
                            </label>
                            <input name="OffsetY" type="range" min="-100" max="100" value="{{ if .Instructor.OffsetY }}{{ .Instructor.OffsetY }}{{ else }}0{{ end }}" class="range range-xs range-success" oninput="updateOffsetYValue(this)"/>
                        </div>
                        <div class="form-control mt-4">
                            <button type="button" class="btn btn-outline btn-sm" onclick="resetImageTransform()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                                Reset Position & Zoom
                            </button>
                        </div>
                        <div class="form-control w-full mt-4">
                            <label class="label">
                                <span class="label-text">Bio</span>
                            </label>
                            <textarea placeholder="Instructor bio..." class="textarea textarea-bordered textarea-lg w-full h-72" 
                                      name="Bio" id="bio-input" oninput="updateInstructorPreview()">{{ .Instructor.Bio }}</textarea>
                        </div>
                        
                        <div class="form-control mt-6">
                            <div class="flex gap-2 pt-4">
                                <button type="submit" class="btn btn-primary">{{ if .Instructor.ID }}Update Instructor{{ else }}Create Instructor{{ end }}</button>
                                <a href="/instructors" class="btn btn-ghost">Cancel</a>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Preview Column -->
                <div class="border-l pl-8">
                    <h2 class="text-2xl font-bold mb-6">Preview</h2>
                    <div class="instructor md:flex py-7">
                        <div class="h-72 mx-auto mb-5 lg:pb-0 overflow-hidden rounded-xl">
                            <img id="preview-picture" 
                                 class="w-full h-full object-cover origin-center transform transition-transform duration-200 ease-in-out {{ if not .Instructor.PictureUrl }}hidden{{ end }}" 
                                 src="{{ .Instructor.PictureUrl }}" 
                                 alt="Instructor preview"
                                 style="transform: scale({{ if .Instructor.ZoomLevel }}{{ .Instructor.InitialZoomLevel }}{{ else }}1{{ end }});
                                 translateX({{ if .Instructor.OffsetX }}{{ .Instructor.OffsetX }}px{{ else }}0{{ end }});
                                 translateY({{ if .Instructor.OffsetY }}{{ .Instructor.OffsetY }}px{{ else }}0{{ end }});">
                        </div>
                        <div class="px-4 lg:px-8 flex-1">
                            <div class="flex justify-between items-start">
                                <h1 id="preview-name" class="text-xl pb-5 font-bold">{{ .Instructor.Name }}</h1>
                            </div>
                            <p id="preview-bio">{{ .Instructor.Bio }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{ end }}
